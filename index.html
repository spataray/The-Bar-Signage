<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>T.A. Station - TV Display</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<div id="status-indicator">KARAOKE MODE ACTIVE</div>

<div id="app-container">
    <div id="video-section">
        <div id="player"></div>
    </div>

    <aside id="ad-sidebar">
        <h1 id="ad-title" style="color:var(--bar-gold); text-align:center; text-transform:uppercase;"></h1>
        <img id="ad-flyer" src="" alt="Flyer">
        <p id="ad-desc" style="text-align:center; font-size: 1.2rem;"></p>
        
        <div class="menu-section" id="menu-content">
            </div>
    </aside>
</div>

<div id="ticker-container">
    <div class="ticker-wrap">
        <div id="ticker-text">Welcome to T.A. Station Honolulu!</div>
    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
<script src="https://www.youtube.com/iframe_api"></script>

<script>
    // 1. DATA SOURCES (Your CSV Export Links)
    const URL_ADS = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSY_76oR-biNXkDm9_MUA-RjKm-DBkeaAX903MPQJHMd2Ku_HFj2Z8w8xDIA-mxl7-Bf474N7MlKdYY/pub?gid=572262531&single=true&output=csv";
    const URL_MENU = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSY_76oR-biNXkDm9_MUA-RjKm-DBkeaAX903MPQJHMd2Ku_HFj2Z8w8xDIA-mxl7-Bf474N7MlKdYY/pub?gid=1406308889&single=true&output=csv";
    const URL_TICKER = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSY_76oR-biNXkDm9_MUA-RjKm-DBkeaAX903MPQJHMd2Ku_HFj2Z8w8xDIA-mxl7-Bf474N7MlKdYY/pub?gid=1639387472&single=true&output=csv";

    // 2. FIREBASE CONFIGURATION
    // *** PASTE YOUR CONFIG FROM FIREBASE CONSOLE HERE ***
    // Import the functions you need from the SDKs you need
import { initializeApp } from "firebase/app";
import { getAnalytics } from "firebase/analytics";
// TODO: Add SDKs for Firebase products that you want to use
// https://firebase.google.com/docs/web/setup#available-libraries

// Your web app's Firebase configuration
// For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyByZx_LjyqpqOl90XMZFWy4eHBQJklCooc",
  authDomain: "ta-station-remote.firebaseapp.com",
  databaseURL: "https://ta-station-remote-default-rtdb.firebaseio.com",
  projectId: "ta-station-remote",
  storageBucket: "ta-station-remote.firebasestorage.app",
  messagingSenderId: "805160829750",
  appId: "1:805160829750:web:9a2a9e1cbf639562aba997",
  measurementId: "G-WV7S73Y54L"
};
// Initialize Firebase
const app = initializeApp(firebaseConfig);
const analytics = getAnalytics(app);
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let player;
    let isLocked = false;

    // 3. YOUTUBE API SETUP
    function onYouTubeIframeAPIReady() {
        player = new YT.Player('player', {
            videoId: 'dQw4w9WgXcQ', // Replace with your default bar music video
            playerVars: { 
                'autoplay': 1, 
                'controls': 1, 
                'rel': 0,
                'mute': 0 
            }
        });
    }

    // 4. CONTENT SYNC (Google Sheets)
    async function syncContent() {
        try {
            // Fetch and Parse Ads
            const adRes = await fetch(URL_ADS);
            const adText = await adRes.text();
            const adRows = adText.split('\n').map(r => r.split(','));
            document.getElementById('ad-title').innerText = adRows[0][0] || "T.A. Station";
            document.getElementById('ad-desc').innerText = adRows[1][0] || "Honolulu, Hawaii";
            
            const flyerUrl = adRows[2] ? adRows[2][0].trim() : "";
            if(flyerUrl.startsWith('http')) {
                document.getElementById('ad-flyer').src = flyerUrl;
                document.getElementById('ad-flyer').style.display = 'block';
            }

            // Fetch and Parse Menu
            const menuRes = await fetch(URL_MENU);
            const menuText = await menuRes.text();
            const menuRows = menuText.split('\n').map(r => r.split(','));
            let menuHtml = "<h3>DRINKS & PUPUS</h3>";
            menuRows.forEach(row => {
                if(row[0] && row[0] !== "Item Name") {
                    menuHtml += `<div class="menu-item"><span>${row[0]}</span><span>${row[1] || ''}</span></div>`;
                }
            });
            document.getElementById('menu-content').innerHTML = menuHtml;

            // Fetch and Parse Ticker
            const tickRes = await fetch(URL_TICKER);
            const tickText = await tickRes.text();
            const tickRows = tickText.split('\n');
            document.getElementById('ticker-text').innerText = tickRows.join(' â€¢ ');

        } catch (e) {
            console.error("Content Sync Failed:", e);
        }
    }

    // 5. REMOTE CONTROL LISTENERS (Firebase)
    db.ref('settings/karaokeLock').on('value', (snapshot) => {
        isLocked = snapshot.val();
        const indicator = document.getElementById('status-indicator');
        const container = document.getElementById('app-container');
        
        if (isLocked) {
            indicator.style.display = 'block';
            container.classList.remove('ad-active');
        } else {
            indicator.style.display = 'none';
        }
    });

    db.ref('settings/forceAd').on('value', (snapshot) => {
        // Every time this value changes in Firebase, trigger the ad
        if (!isLocked) {
            const container = document.getElementById('app-container');
            container.classList.add('ad-active');
            setTimeout(() => container.classList.remove('ad-active'), 25000);
        }
    });

    // 6. AUTOMATED AD TIMER
    setInterval(() => {
        if (!isLocked) {
            const container = document.getElementById('app-container');
            container.classList.add('ad-active');
            setTimeout(() => container.classList.remove('ad-active'), 20000); // Ad duration
        }
    }, 180000); // Run every 3 minutes

    // Initial load
    syncContent();
    setInterval(syncContent, 60000); // Re-sync sheets every minute

</script>
</body>
</html>
