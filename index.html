<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>T.A. Station - TV Display</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<div id="status-indicator">KARAOKE MODE ACTIVE</div>

<div id="app-container">
    <div id="video-section">
        <div id="player"></div>
    </div>

    <aside id="ad-sidebar">
        <h1 id="ad-title" style="color:var(--bar-gold); text-align:center; text-transform:uppercase;"></h1>
        <img id="ad-flyer" src="" alt="Flyer">
        <p id="ad-desc" style="text-align:center; font-size: 1.2rem;"></p>
        <div class="menu-section" id="menu-content"></div>
    </aside>
</div>

<div id="ticker-container">
    <div class="ticker-wrap"><div id="ticker-text">Welcome to T.A. Station Honolulu!</div></div>
</div>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
<script src="https://www.youtube.com/iframe_api"></script>

<script>
    // 1. DATA SOURCES
    const URL_ADS = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSY_76oR-biNXkDm9_MUA-RjKm-DBkeaAX903MPQJHMd2Ku_HFj2Z8w8xDIA-mxl7-Bf474N7MlKdYY/pub?gid=572262531&single=true&output=csv";
    const URL_MENU = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSY_76oR-biNXkDm9_MUA-RjKm-DBkeaAX903MPQJHMd2Ku_HFj2Z8w8xDIA-mxl7-Bf474N7MlKdYY/pub?gid=1406308889&single=true&output=csv";
    const URL_TICKER = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSY_76oR-biNXkDm9_MUA-RjKm-DBkeaAX903MPQJHMd2Ku_HFj2Z8w8xDIA-mxl7-Bf474N7MlKdYY/pub?gid=1639387472&single=true&output=csv";

       // 2. FIREBASE CONFIGURATION
const firebaseConfig = {
    apiKey: "AIzaSyByZx_LjyqpqOl90XMZFWy4eHBQJklCooc", // Copy the long string from your screenshot here
    authDomain: "ta-station-remote.firebaseapp.com",
    databaseURL: "https://ta-station-remote-default-rtdb.firebaseio.com",
    projectId: "ta-station-remote",
    storageBucket: "ta-station-remote.firebasestorage.app",
    messagingSenderId: "805160829750",
    appId: "1:805160829750:web:9a2a9e1cbf639562aba997",
    measurementId: "G-WV7S73Y54L"
};
    // Initialize Firebase using the v8 syntax to match the scripts above
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // Define player variable globally so the API can find it
    var player;
    var isLocked = false;

    // 3. YOUTUBE API SETUP
    function onYouTubeIframeAPIReady() {
        player = new YT.Player('player', {
            videoId: 'dQw4w9WgXcQ', 
            playerVars: { 
                'autoplay': 1, 
                'controls': 1, 
                'rel': 0,
                'mute': 0,
                'enablejsapi': 1 
            }
        });
    }

    // 4. CONTENT SYNC (Google Sheets)
    async function syncContent() {
        try {
            const adRes = await fetch(URL_ADS);
            const adText = await adRes.text();
            const adRows = adText.split('\n').map(r => r.split(','));
            document.getElementById('ad-title').innerText = adRows[0][0] || "T.A. Station";
            document.getElementById('ad-desc').innerText = adRows[1][0] || "";
            
            const flyerUrl = adRows[2] ? adRows[2][0].trim() : "";
            if(flyerUrl.startsWith('http')) {
                document.getElementById('ad-flyer').src = flyerUrl;
                document.getElementById('ad-flyer').style.display = 'block';
            }

            const menuRes = await fetch(URL_MENU);
            const menuText = await menuRes.text();
            const menuRows = menuText.split('\n').map(r => r.split(','));
            let menuHtml = "<h3>DRINKS & PUPUS</h3>";
            menuRows.forEach(row => {
                if(row[0] && row[0] !== "Item Name") {
                    menuHtml += `<div class="menu-item"><span>${row[0]}</span><span>${row[1] || ''}</span></div>`;
                }
            });
            document.getElementById('menu-content').innerHTML = menuHtml;

            const tickRes = await fetch(URL_TICKER);
            const tickText = await tickRes.text();
            const tickRows = tickText.split('\n');
            document.getElementById('ticker-text').innerText = tickRows.join(' â€¢ ');

        } catch (e) { console.error("Sync Failed", e); }
    }

    // 5. REMOTE CONTROL LISTENERS
    db.ref('settings/karaokeLock').on('value', (snapshot) => {
        isLocked = snapshot.val();
        document.getElementById('status-indicator').style.display = isLocked ? 'block' : 'none';
        if (isLocked) document.getElementById('app-container').classList.remove('ad-active');
    });

    db.ref('settings/currentVideoId').on('value', (snapshot) => {
        const vid = snapshot.val();
        if (vid && player && player.loadVideoById) player.loadVideoById(vid);
    });

    db.ref('settings/forceAd').on('value', (snapshot) => {
        if (!isLocked) {
            document.getElementById('app-container').classList.add('ad-active');
            setTimeout(() => document.getElementById('app-container').classList.remove('ad-active'), 25000);
        }
    });

    // Initial load
    syncContent();
    setInterval(syncContent, 60000); 

</script>
</body>
</html>
